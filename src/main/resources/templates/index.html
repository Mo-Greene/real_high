<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/header :: common_head}"></head>

<body>
<!-- 1. 숨겨진 파일 인풋 폼 추가 -->
<form id="uploadForm" action="/image" method="post" enctype="multipart/form-data" class="hidden">
    <input type="file" id="roomFileInput" name="image" accept="image/*">
</form>

<div class="w-screen min-w-[280px] max-w-[480px] min-h-screen bg-white mx-auto overflow-hidden flex flex-col justify-between">

    <div class="flex justify-between items-center w-[393px] h-14 px-3 py-10 self-center">
        <div class="flex justify-center items-center flex-grow-0 flex-shrink-0 w-12 h-12 relative rounded-[99px]">
            <div class="flex-grow-0 flex-shrink-0 w-6 h-6 relative overflow-hidden"></div>
        </div>
        <div class="flex justify-start items-center flex-grow-0 flex-shrink-0 relative gap-1.5">
            <img th:src="@{/logo/header-logo.svg}" alt="logo" />
        </div>
        <div class="flex justify-center items-center flex-grow-0 flex-shrink-0 w-12 h-12 relative rounded-[99px]">
            <div class="flex-grow-0 flex-shrink-0 w-6 h-6 relative overflow-hidden"></div>
        </div>
    </div>

    <div class="flex flex-col justify-start items-start w-[393px] relative gap-12 p-6 self-center">
        <div class="self-stretch flex-grow-0 flex-shrink-0 h-[460px] relative rounded-3xl bg-white">
            <img th:src="@{/image/index/main.png}" alt=""
                 class="w-[345px] h-[460px] absolute left-[-1px] top-[-1px] rounded-3xl object-none"/>
            <img th:src="@{/image/index/main-absolute1.png}" alt=""
                 class="w-24 h-24 absolute left-[260px] top-[47px] rounded-xl object-none border border-white/[0.32]"
                 style="box-shadow: 0px 24px 48px 0 rgba(72,45,21,0.25);"/>
            <img th:src="@{/image/index/main-absolute2.png}" alt=""
                 class="w-[104px] h-[104px] absolute left-[-17px] top-[189px] rounded-xl object-none border border-white/[0.32]"
                 style="box-shadow: 0px 16px 32px 0 rgba(40,38,5,0.12);"/>
            <img th:src="@{/image/index/main-absolute3.png}" alt=""
                 class="w-[120px] h-[120px] absolute left-[120px] top-[363px] rounded-xl object-none border border-white/[0.32]"
                 style="box-shadow: 0px 12px 24px 0 rgba(72,34,11,0.08);"/>
        </div>
        <div class="flex flex-col justify-start items-center self-stretch flex-grow-0 flex-shrink-0 relative gap-3 px-6">
            <p class="self-stretch flex-grow-0 flex-shrink-0 w-[297px] text-lg font-semibold text-center text-[#17181a]">
                두 개의 사진, 완벽한 합성
            </p>
            <p class="self-stretch flex-grow-0 flex-shrink-0 w-[297px] text-[15px] font-semibold text-center text-black/[0.48]">
                제품 구매 전, 우리집에 어울리는지 확인해 보세요
            </p>
        </div>
    </div>

    <div class="px-12 py-10 flex flex-col items-start gap-2">
        <!-- 2. <a> 태그를 <button>으로 변경하고 id 부여 -->
        <button id="startButton" class="flex justify-center items-center self-stretch h-12 px-6
            bg-[#007bff] rounded-full border border-white/40 cursor-pointer
            transition duration-300 ease-in-out
            hover:-translate-y-1 hover:shadow-lg active:scale-90 active:opacity-60">
            <p id="startButtonText" class="text-[15px] font-semibold text-white">
                시작하기
            </p>
        </button>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const startButton = document.getElementById('startButton');
        const startButtonText = document.getElementById('startButtonText');
        const roomFileInput = document.getElementById('roomFileInput');
        const uploadForm = document.getElementById('uploadForm');

        let defaultAction = () => {
            window.location.href = '/main';
        };
        startButton.onclick = defaultAction;

        const isReturning = sessionStorage.getItem('isReturningUser');

        if (isReturning === 'true') {
            if (startButton && roomFileInput && uploadForm && startButtonText) {
                startButtonText.textContent = '사진 불러오기';

                startButton.onclick = () => {
                    roomFileInput.click();
                };

                roomFileInput.addEventListener('change', (event) => {
                    const file = event.target.files[0];
                    if (file) {
                        startButtonText.textContent = '업로드 중...';
                        startButton.disabled = true;
                        uploadForm.submit();
                    }
                });
            }
        }
    });
</script>

</body>
</html>
