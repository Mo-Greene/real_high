<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/header :: common_head}"></head>

<body>

<div th:if="${error}" class="w-full h-screen flex items-center justify-center bg-red-100 text-red-700 p-4">
    <p>오류: <span th:text="${error}"></span></p>
    <a href="/main" class="ml-4 px-4 py-2 bg-red-600 text-white rounded">돌아가기</a>
</div>

<div id="mainContent" class="w-[393px] min-h-screen bg-[#17181A] mx-auto flex flex-col">

    <header class="flex w-full h-14 px-3 justify-between items-center flex-shrink-0">
        <div onclick="history.back()" class="cursor-pointer w-12 h-12 flex justify-center items-center rounded-full">
            <div class="w-12 h-12 bg-cover bg-center" th:style="'background-image: url(' + @{/image/button/back-image.svg} + ');'"></div>
        </div>

        <p class="flex-grow-0 flex-shrink-0 text-[13px] font-semibold text-center text-white">
            방 사진 완료 !
        </p>

        <div class="flex justify-center items-center flex-grow-0 flex-shrink-0 w-12 h-12 relative rounded-[99px]">
            <div class="flex-grow-0 flex-shrink-0 w-6 h-6 relative overflow-hidden"></div>
        </div>
    </header>

    <main class="flex flex-col flex-grow relative justify-center">


        <input type="file" id="furnitureFileInput" class="hidden" accept="image/*">

        <div id="imageContainer" class="w-full h-auto relative">

            <img id="roomImage"
                 class="w-full h-auto object-contain max-h-[662px] mx-auto"
                 th:src="@{/image/content}" />

            <div id="furnitureWrapper" class="resize-box absolute top-0 left-0 w-1/2 opacity-80 hidden flex"
                 style="position: absolute; left: 0px; top: 0px;"
            >
                <img id="furniturePreview" class="w-full h-full object-contain cursor-move" src="" alt=""/>

                <svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg"
                     class="resize-handle top-left">
                    <path d="M25.5 1.5H1.5V25.5" stroke="white" stroke-width="3"></path>
                </svg>
                <svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg"
                     class="resize-handle top-right">
                    <path d="M25.5 1.5H1.5V25.5" stroke="white" stroke-width="3"></path>
                </svg>
                <svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg"
                     class="resize-handle bottom-left">
                    <path d="M25.5 1.5H1.5V25.5" stroke="white" stroke-width="3"></path>
                </svg>
                <svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg"
                     class="resize-handle bottom-right">
                    <path d="M25.5 1.5H1.5V25.5" stroke="white" stroke-width="3"></path>
                </svg>
            </div>
        </div>

        <div id="loadingSpinner"
             class="hidden absolute inset-0 bg-black/70 flex flex-col justify-center items-center z-50 rounded-3xl">
            <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-white"></div>
            <p class="text-white ml-4 mt-4">AI가 생성 중입니다...</p>
        </div>
    </main>

    <footer id="footer-single-button" class="px-12 py-5 flex-shrink-0">
        <button id="actionButton" class="w-full h-12 flex justify-center items-center self-stretch flex-grow-0 flex-shrink-0 relative px-6 rounded-[99px] bg-[#17181a] border border-white/40 cursor-pointer transition duration-300 ease-in-out hover:-translate-y-1">
            <p id="buttonText" class="flex-grow-0 flex-shrink-0 text-[15px] font-semibold text-center text-white">
                가구 사진 불러오기
            </p>
        </button>
    </footer>

    <footer id="footer-multi-button" class="hidden flex flex-col justify-center items-start w-[393px] gap-2 px-12 py-3">
        <div id="downloadButton"
             class="flex justify-center items-center self-stretch flex-grow-0 flex-shrink-0 h-12 relative px-6 rounded-[99px] bg-[#007bff] border border-white/40 cursor-pointer transition duration-300 ease-in-out hover:-translate-y-1">
            <p class="flex-grow-0 flex-shrink-0 text-[15px] font-semibold text-center text-white">
                이미지 다운로드
            </p>
        </div>
        <div id="addFurnitureButton"
             class="flex justify-center items-center self-stretch flex-grow-0 flex-shrink-0 h-12 relative px-6 rounded-[99px] bg-[#17181a] border border-white/40 cursor-pointer transition duration-300 ease-in-out hover:-translate-y-1">
            <p class="flex-grow-0 flex-shrink-0 text-[15px] font-semibold text-center text-white">
                가구 추가하기
            </p>
        </div>
        <div id="resetButton"
             class="flex justify-center items-center self-stretch flex-grow-0 flex-shrink-0 h-12 relative px-6 rounded-[99px] cursor-pointer transition duration-300 ease-in-out hover:-translate-y-1">
            <p class="flex-grow-0 flex-shrink-0 text-[15px] font-semibold text-center text-white">
                처음으로 돌아가기
            </p>
        </div>
    </footer>
</div>

<div id="adLoadingPage" class="hidden">
    <div class="w-[393px] min-h-screen overflow-hidden bg-white mx-auto flex flex-col justify-center items-center">
        <div class="flex flex-col justify-start items-center w-[393px]">
            <div class="flex flex-col justify-start items-center self-stretch flex-grow-0 flex-shrink-0 h-[250px] relative gap-6 py-[72px]">
                <div class="flex justify-start items-center flex-grow-0 flex-shrink-0 relative gap-2">
                    <lottie-player src="https://cdn.lottielab.com/l/AY9mNrHsrN6GLR.json"
                                   background="transparent"
                                   speed="1"
                                   style="width: 48px; height: 48px;"
                                   loop
                                   autoplay
                    ></lottie-player>
                </div>
                <p class="self-stretch flex-grow-0 flex-shrink-0 w-[393px] text-[15px] font-semibold text-center text-black/[0.48]">
                    <span class="self-stretch flex-grow-0 flex-shrink-0 w-[393px] text-[15px] font-semibold text-center text-black/[0.48]">가구를 배치 중이에요</span><br />
                    <span class="self-stretch flex-grow-0 flex-shrink-0 w-[393px] text-[15px] font-semibold text-center text-black/[0.48]">잠시만 기다려주세요</span>
                </p>
            </div>
        </div>
    </div>
</div>

<style>
    /* 리사이즈 박스 테두리 */
    .resize-box {
        box-sizing: border-box;
        justify-content: center;
        align-items: center;
    }
    .resize-box img {
        display: block; /* 이미지 아래 여백 제거 */
    }

    /* 리사이즈 핸들 스타일 (SVG) */
    .resize-handle {
        position: absolute;
        width: 26px;
        height: 26px;
        z-index: 10;
    }

    /* 각 핸들의 위치 및 회전 */
    .resize-handle.top-left {
        top: -3px;
        left: -3px;
        cursor: nwse-resize;
    }
    .resize-handle.top-right {
        top: -3px;
        right: -3px;
        cursor: nesw-resize;
        transform: rotate(90deg);
    }
    .resize-handle.bottom-left {
        bottom: -3px;
        left: -3px;
        cursor: nesw-resize;
        transform: rotate(-90deg);
    }
    .resize-handle.bottom-right {
        bottom: -3px;
        right: -3px;
        cursor: nwse-resize;
        transform: rotate(180deg);
    }
</style>

<script th:src="@{/js/image.js}"></script>
</body>
</html>